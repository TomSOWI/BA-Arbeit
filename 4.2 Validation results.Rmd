---
title: "4.2 Validation results"
author: "Tom Klotz"
date: "21 6 2023"
output: html_document
---

#############################################################
# 2014
#############################################################

```{r}
corp2014 <- corpus(df2014, text_field = "speech_content")
saveRDS(corp2014, file = "corp2014.RDS")
corp_2014clean <- corp_preparation_expertyears(corp2014, pattern = popdictR::gruendl_terms)
saveRDS(corp_2014_clean, file = "corp_2014_clean.RDS")


pattern <- gruendl_patterns_to_compound()

result2014Clara <- run_weighted_multiword_dict(corp = corp2014, corp_compund = corp_2014_clean, pattern = pattern, pattern_name = "gruendl", pattern_weight = dfClaraJaccard, pattern_weight_name = "clara", include_main_dict = TRUE,include_totals = TRUE)

result2014ClaraK <- run_weighted_multiword_dict(corp = corp2014, corp_compund = corp_2014_clean, pattern = pattern, pattern_weight = dfClaraKJaccard,pattern_weight_name = "claraK", include_main_dict = F,include_totals = F)

result2014Kmeans <- run_weighted_multiword_dict(corp = corp2014, corp_compund = corp_2014_clean, pattern = pattern, pattern_weight = dfKmeans, pattern_weight_name = "kmeans", include_main_dict = F,include_totals = F)

result2014KmeansK <- run_weighted_multiword_dict(corp = corp2014, corp_compund = corp_2014_clean, pattern = pattern, pattern_weight = dfKmeansK, pattern_weight_name = "kmeansK", include_main_dict = F,include_totals = F)

result2014 <- bind_cols(result2014Clara,select(result2014ClaraK, claraK), select(result2014Kmeans, kmeans), select(result2014KmeansK, kmeansK))


for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
  result2014[[i]] <- result2014[[i]] / result2014$n_sentences
  result2014[[i]] <- scale(result2014[[i]], center = T)
}
result2014$party[result2014$party == "DIE LINKE."] <- "LINKE"
validation2014 <- merge(result2014, exp2014)

correlation2014 <- list()

for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
    correlation <- cor(x = validation2014[[i]], y = validation2014$expert_rating, method = "pearson")
    correlation2014[[i]] <- correlation 
}


```


#############################################################
# 2017
#############################################################

```{r}
corp2017 <- corpus(df2017, text_field = "speech_content")
saveRDS(corp2017, file = "corp2017.RDS")
corp_2017clean <- corp_preparation_expertyears(corp2017, pattern = popdictR::gruendl_terms)
saveRDS(corp_2017_clean, file = "corp_2017_clean.RDS")


pattern <- gruendl_patterns_to_compound()

result2017Clara <- run_weighted_multiword_dict(corp = corp2017, corp_compund = corp_2017_clean, pattern = pattern, pattern_name = "gruendl", pattern_weight = dfClaraJaccard, pattern_weight_name = "clara", include_main_dict = TRUE,include_totals = TRUE)

result2017ClaraK <- run_weighted_multiword_dict(corp = corp2017, corp_compund = corp_2017_clean, pattern = pattern, pattern_weight = dfClaraKJaccard,pattern_weight_name = "claraK", include_main_dict = F,include_totals = F)

result2017Kmeans <- run_weighted_multiword_dict(corp = corp2017, corp_compund = corp_2017_clean, pattern = pattern, pattern_weight = dfKmeans, pattern_weight_name = "kmeans", include_main_dict = F,include_totals = F)

result2017KmeansK <- run_weighted_multiword_dict(corp = corp2017, corp_compund = corp_2017_clean, pattern = pattern, pattern_weight = dfKmeansK, pattern_weight_name = "kmeansK", include_main_dict = F,include_totals = F)

result2017 <- bind_cols(result2017Clara,select(result2017ClaraK, claraK), select(result2017Kmeans, kmeans), select(result2017KmeansK, kmeansK))


for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
  result2017[[i]] <- result2017[[i]] / result2017$n_sentences
  result2017[[i]] <- scale(result2017[[i]], center = T)
}
result2017$party[result2017$party == "DIE LINKE."] <- "LINKE"
validation2017 <- merge(result2017, exp2017)

correlation2017 <- list()

for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
    correlation <- cor(x = validation2017[[i]], y = validation2017$expert_rating, method = "pearson")
    correlation2017[[i]] <- correlation 
}


```



#############################################################
# 2019
#############################################################

```{r}
corp2019 <- corpus(df2019, text_field = "speech_content")
saveRDS(corp2019, file = "corp2019.RDS")
corp_2019clean <- corp_preparation_expertyears(corp2019, pattern = popdictR::gruendl_terms)
saveRDS(corp_2019_clean, file = "corp_2019_clean.RDS")


pattern <- gruendl_patterns_to_compound()

result2019Clara <- run_weighted_multiword_dict(corp = corp2019, corp_compund = corp_2019_clean, pattern = pattern, pattern_name = "gruendl", pattern_weight = dfClaraJaccard, pattern_weight_name = "clara", include_main_dict = TRUE,include_totals = TRUE)

result2019ClaraK <- run_weighted_multiword_dict(corp = corp2019, corp_compund = corp_2019_clean, pattern = pattern, pattern_weight = dfClaraKJaccard,pattern_weight_name = "claraK", include_main_dict = F,include_totals = F)

result2019Kmeans <- run_weighted_multiword_dict(corp = corp2019, corp_compund = corp_2019_clean, pattern = pattern, pattern_weight = dfKmeans, pattern_weight_name = "kmeans", include_main_dict = F,include_totals = F)

result2019KmeansK <- run_weighted_multiword_dict(corp = corp2019, corp_compund = corp_2019_clean, pattern = pattern, pattern_weight = dfKmeansK, pattern_weight_name = "kmeansK", include_main_dict = F,include_totals = F)

result2019 <- bind_cols(result2019Clara,select(result2019ClaraK, claraK), select(result2019Kmeans, kmeans), select(result2019KmeansK, kmeansK))


for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
  result2019[[i]] <- result2019[[i]] / result2019$n_sentences
  result2019[[i]] <- scale(result2019[[i]], center = T)
}
result2019$party[result2019$party == "DIE LINKE."] <- "LINKE"
result2019$party[result2019$party == "Fraktionslos"] <- NA
result2019 <- na.omit(result2019)
validation2019 <- merge(result2019, exp2019)

correlation2019 <- list()

for (i in c("gruendl", "clara","claraK","kmeans","kmeansK")) {
    correlation <- cor(x = validation2019[[i]], y = validation2019$expert_rating, method = "pearson")
    correlation2019[[i]] <- correlation 
}


```