---
title: "Untitled"
author: "Tom Klotz"
date: "15 6 2023"
output: html_document
---


#############################################################
# CLARA
#############################################################

##############################
## Two Dimensions
##############################




```{r}
# BT17
set.seed(123)
claraBT17 <- clara(distBT17_euclidean, k = 2, samples = 50, pamLike = TRUE)
# Result
claraBT17.image <-fviz_cluster(object = claraBT17, data = distBT17_euclidean, ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT17, file = "claraBT17.RDS")
saveRDS(claraBT17.image, file = "claraBT17.image.RDS")

# Cluster label asignment
dfBT17$cluster.clara <- claraBT17$clustering
dfClaraLinke <- dfBT17[dfBT17$party == "DIE LINKE.",] 
prop.table(table(dfClaraLinke$cluster))
dfBT17$cluster.clara  <- dfBT17$cluster.clara.  - 1 # cluster two is populism
```


```{r}
# BT18

set.seed(123)
claraBT18 <- clara(distBT18_euclidean, k = 2, samples = 50, pamLike = TRUE)

claraBT18.image <-fviz_cluster(object = claraBT18, data = distBT18_euclidean, ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT18, file = "claraBT18.RDS")
saveRDS(claraBT18.image, file = "claraBT18.image.RDS")

# Cluster label asignment
dfBT18$cluster.clara <- claraBT18$clustering
dfClaraLinke <- dfBT18[dfBT18$party == "DIE LINKE.",] 
prop.table(table(dfClaraLinke$cluster)) # 47 vs 57
dfBT18$cluster.clara.  <- dfBT18$cluster.clara  - 1 # cluster two is populism
```


```{r}
# BT19
set.seed(123)
claraBT19 <- clara(distBT19_euclidean, k = 2, samples = 50, pamLike = TRUE)
# Result
claraBT19Jaccrad.image <-fviz_cluster(object = claraBT19, data = distBT19_euclidean, ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT19, file = "claraBT19.RDS")
saveRDS(claraBT19.image, file = "claraBT19.image.RDS")

# Cluster label asignment
dfBT19$cluster.clara <- claraBT19$clustering
dfClaraLinke <- dfBT19[dfBT19$party == "DIE LINKE.",] 
prop.table(table(dfClaraLinke$cluster))
dfClaraAfD <- dfBT19[dfBT19$party == "AfD",] 
prop.table(table(dfClaraAfD$cluster))
dfBT19$cluster.clara.[dfBT19$cluster.clara == 2] <- 0 # cluster one is populism
```


```{r}
# BT20
set.seed(123)
claraBT20 <- clara(distBT20_euclidean,, k = 2, samples = 50, pamLike = TRUE)
#Result
claraBT20.image <-fviz_cluster(object = claraBT20, data = distBT20_euclidean, ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT20, file = "claraBT20.RDS")
saveRDS(claraBT20.image, file = "claraBT20.image.RDS")

# Cluster label asignment
dfBT20$cluster.clara <- claraBT20$clustering
dfClaraLinke <- dfBT20[dfBT20$party == "DIE LINKE.",] 
prop.table(table(dfClaraLinke$cluster))
dfClaraAfD <- dfBT20[dfBT20$party == "AfD",] 
prop.table(table(dfClaraAfD$cluster)) 
dfBT20$cluster.clara.[dfBT20$cluster.clara == 2] <- 0 # cluster one is populism
```

### Merge

```{r}

dfClara <-  rbind(dfBT17,dfBT18,dfBT19,dfBT20)
dfClara <- aggregate(dfClara$cluster, by = list(dfClara$pattern), FUN = "mean")
colnames(dfClara) <- c("pattern","weight")
dfClara$pattern <- make_patterns_compound(dfClara$pattern) #for merging lat
saveRDS(dfClara, file = "dfClara.RDS")

```





##############################
## True Dimensions
##############################


```{r}
# BT20
set.seed(123)
claraBT20TrueK <- fviz_nbclust(as.matrix(distBT20_euclidean), clara, method = "wss") +    
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")


claraBT20K <- clara(distBT20_, truth.K, samples = 50, pamLike = TRUE)

claraBT20K.image <-fviz_cluster(object = claraBT20K, data = distBT20_euclidean,ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT20K, file = "claraBT20K.RDS")
saveRDS(claraBT20K.image, file = "claraBT20K.image.RDS")

# Cluster label asignment
dfBT20$cluster.clara.truek <- claraBT20K$clustering
dfClaraKLinke <- dfBT20[dfBT20$party == "DIE LINKE.",] 
prop.table(table(dfClaraKLinke$cluster))
dfClaraKAfD <- dfBT20[dfBT20$party == "AfD",] 
prop.table(table(dfClaraKAfD$cluster)) 

dfBT20$cluster.clara.truek[dfBT20$cluster.clara.truek == 2] <- 1
dfBT20$cluster.clara.truek[dfBT20$cluster.clara.truek == 3] <- 1
dfBT20$cluster.clara.truek[dfBT20$cluster.clara.truek == 1] <- 0
dfBT20$cluster.clara.truek[dfBT20$cluster.clara.truek == 4] <- 0
```

```{r}
# BT19
set.seed(123)
claraBT19TrueK <- fviz_nbclust(as.matrix(distBT19_euclidean), clara, method = "wss") +    
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")

truth.K = 4 

claraBT19K <- clara(distBT19_euclidean, truth.K, samples = 50, pamLike = TRUE)

claraBT19K.image <-fviz_cluster(object = claraBT19K, data = distBT19_euclidean,ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT19K, file = "claraBT19K.RDS")
saveRDS(claraBT19K.image, file = "claraBT19K.image.RDS")

# Cluster label asignment
dfBT19$cluster.clara.truek <- claraBT19K$clustering
dfClaraKLinke <- dfBT19[dfBT19$party == "DIE LINKE.",] 
prop.table(table(dfClaraKLinke$cluster))
dfClaraKAfD <- dfBT19[dfBT19$party == "AfD",] 
prop.table(table(dfClaraKAfD$cluster))

dfBT19$cluster.clara.truek[dfBT19$cluster.clara.truek == 2] <- 0
dfBT19$cluster.clara.truek[dfBT19$cluster.clara.truek == 3] <- 0
dfBT19$cluster.clara.truek[dfBT19$cluster.clara.truek == 4] <- 0
```

```{r}
# BT18
set.seed(123)
claraBT18TrueK <- fviz_nbclust(as.matrix(distBT18_euclidean), clara, method = "wss") +    
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")

truth.K = 4 

claraBT18K <- clara(distBT18_, truth.K, samples = 50, pamLike = TRUE)

claraBT18K.image <-fviz_cluster(object = claraBT18K, data = distBT18_euclidean,ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT18K, file = "claraBT18K.RDS")
saveRDS(claraBT18K.image, file = "claraBT18K.image.RDS")

# Cluster label asignment
dfBT18$cluster.clara.truek <- claraBT18K$clustering
dfClaraKLinke <- dfBT18[dfBT18$party == "DIE LINKE.",] 
prop.table(table(dfClaraKLinke$cluster))

dfBT18$cluster.clara.truek[dfBT18$cluster.clara.truek == 2] <- 1
dfBT18$cluster.clara.truek[dfBT18$cluster.clara.truek == 3] <- 0
dfBT18$cluster.clara.truek[dfBT18$cluster.clara.truek == 4] <- 0



```

```{r}
# BT 17
set.seed(123)
claraBT17TrueK <- fviz_nbclust(as.matrix(distBT17_euclidean), clara, method = "wss") +    
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")

truth.K = 4 

claraBT17K <- clara(distBT17_, samples = 50, pamLike = TRUE)

claraBT17K.image <-fviz_cluster(object = claraBT17K, data = distBT17_euclidean,ellipse.type = "norm",
             geom = "point")

saveRDS(claraBT17K, file = "claraBT17K.RDS")
saveRDS(claraBT17K.image, file = "claraBT17K.image.RDS")

# Cluster label asignment
dfBT17$cluster.clara.truek <- claraBT17K$clustering
dfClaraKLinke <- dfBT17[dfBT17$party == "DIE LINKE.",] 
prop.table(table(dfClaraKLinke$cluster))

dfBT17$cluster.clara.truek[dfBT17$cluster.clara.truek == 1] <- 0
dfBT17$cluster.clara.truek[dfBT17$cluster.clara.truek == 2] <- 1
dfBT17$cluster.clara.truek[dfBT17$cluster.clara.truek == 3] <- 0
dfBT17$cluster.clara.truek[dfBT17$cluster.clara.truek == 4] <- 0

```

### Merge

```{r}
dfClaraK <-  rbind(dfBT17,dfBT18,dfBT19,dfBT20)
dfClaraK <- aggregate(dfClaraK$cluster, by = list(dfClaraK$pattern), FUN = "mean")
colnames(dfClaraK) <- c("pattern","weight")
dfClaraK$pattern <- make_patterns_compound(dfClaraK$pattern) #for merging lat
saveRDS(dfClaraK, file = "dfClaraK.RDS")
```

