---
title: "Untitled"
author: "Tom Klotz"
date: "29 7 2023"
output: html_document
---

### Split-half-reliability

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(splithalfr)

```



```{r}
corp <- corpBT17_20
toks <- toksBT17_20_clean 
docnames(toks) <- docvars(corp)$id
docvars(toks)$party <- docvars(corp)$party
docvars(toks)$n_sentences <- quanteda::nsentence(corp)
docvars(toks)$n_tokens <- quanteda::ntoken(toks)
```


```{r}

pattern <- dfClara$pattern
reliaGruendl <- list()
reliaClara <- list()
reliaClaraK <- list()
reliaKmeans <- list()
reliaKmeansK <- list()



for (i in c(0:1)){
  
  half_1 <- sample(
  x = pattern,
  size = round(length(pattern)/2, 0),
  replace = FALSE
  )
  half_2 <- pattern[!(pattern %in% half_1)]


  dfClara1 <- dfClara[dfClara$pattern %in% half_1,]
  dfClara2 <- dfClara[dfClara$pattern %in% half_2,]
  dfClaraK1 <- dfClaraK[dfClaraK$pattern %in% half_1,]
  dfClaraK2 <- dfClaraK[dfClaraK$pattern %in% half_2,]
  dfKmeans1 <- dfKmeans[dfKmeans$pattern %in% half_1,]
  dfKmeans2 <- dfKmeans[dfKmeans$pattern %in% half_2,]
  dfKmeansK1 <- dfKmeansK[dfKmeansK$pattern %in% half_1,]
  dfKmeansK2 <- dfKmeansK[dfKmeansK$pattern %in% half_2,]
  

  
  resultClara1 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfClara1,
    dict_weight_name = "clara1",
    prepare_corp = FALSE,
    include_main_dict = T,
    include_totals = F
  )
  
  resultClara2 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfClara2,
    dict_weight_name = "clara2",
    prepare_corp = FALSE,
    include_main_dict = T,
    include_totals = F
  )
  
  resultClaraK1 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfClaraK1,
    dict_weight_name = "claraK1",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
  
  resultClaraK2 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfClaraK2,
    dict_weight_name = "claraK2",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
  
  resultKmeans1 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfKmeans1,
    dict_weight_name = "kmeans1",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
  
   resultKmeans2 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfKmeans2,
    dict_weight_name = "kmeans2",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
   
  resultKmeansK1 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfKmeansK1,
    dict_weight_name = "kmeansK1",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
  
   resultKmeansK2 <- run_weighted_multiword_dict(
    data = toks,
    dict_compound = pattern,
    dict_name = "gruendl",
    dict_weight = dfKmeansK2,
    dict_weight_name = "kmeansK2",
    prepare_corp = FALSE,
    include_main_dict = F,
    include_totals = F
  )
  
  sbGruendl <- spearman_brown(resultClara1$gruendl,resultClara2$gruendl)
  sbClara <- spearman_brown(resultClara1$clara1, resultClara2$clara2)
  sbClaraK <- spearman_brown(resultClaraK1$claraK1, resultClaraK2$claraK2)
  sbKmeans <- spearman_brown(resultKmeans1$kmeans1, resultKmeans2$kmeans2)
  sbKmeansK <- spearman_brown(resultKmeansK1$kmeansK1, resultKmeansK2$kmeansK2)
  
  reliaGruendl[i] <- sbGruendl
  reliaClara[i] <- sbClara
  reliaClaraK[i] <- sbClaraK
  reliaKmeans[i] <- sbKmeans
  reliaKmeansK[i] <- sbKmeansK
}

saveRDS(reliaGruendl, file = "reliaGruendl.RDS")
saveRDS(reliaClara, file = "reliaClara.RDS")
saveRDS(reliaClaraK, file = "reliaClaraK.RDS")
saveRDS(reliaKmeansK, file = "reliaKmeansK.RDS")
saveRDS(reliaKmeans, file = "reliaKmeans.RDS")

```




```{r}
:
```

